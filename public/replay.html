<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OpenDisaster â€” Replay Viewer</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #0d0d1a; color: #eee;
      font-family: system-ui, -apple-system, sans-serif;
      height: 100vh; overflow: hidden;
    }

    /* Top bar */
    .top-bar {
      display: flex; align-items: center; gap: 12px;
      padding: 10px 16px;
      background: #1a1a2e; border-bottom: 1px solid #333;
    }
    .top-bar h1 {
      font-size: 14px; color: #4fc3f7;
      font-family: monospace; letter-spacing: 1px;
      text-transform: uppercase; margin-right: 8px;
    }
    .top-bar select {
      flex: 1; max-width: 500px;
      padding: 6px 10px;
      background: #0d0d1a; border: 1px solid #444;
      border-radius: 6px; color: #eee; font-size: 13px;
    }
    .top-bar a, .top-bar button {
      padding: 6px 14px;
      background: #2a2a3e; border: 1px solid #444;
      border-radius: 6px; color: #ccc; font-size: 12px;
      text-decoration: none; cursor: pointer;
      transition: background 0.15s;
    }
    .top-bar a:hover, .top-bar button:hover { background: #3a3a4e; }
    .top-bar button.danger { color: #e55; border-color: #622; }
    .top-bar button.danger:hover { background: #3a1a1a; }

    /* Main layout */
    .main {
      display: flex;
      height: calc(100vh - 45px - 56px); /* top bar + controls */
    }

    /* Left: POV + Agent selector */
    .pov-panel {
      display: flex; flex-direction: column;
      width: 400px; min-width: 300px;
      border-right: 1px solid #333;
      background: #111122;
    }
    #pov-canvas {
      width: 100%; aspect-ratio: 1;
      background: #0a0a14;
    }
    .agent-selector {
      padding: 8px 12px;
      border-top: 1px solid #333;
    }
    .agent-selector label {
      font-size: 11px; color: #888;
      text-transform: uppercase; letter-spacing: 0.5px;
    }
    .agent-selector select {
      width: 100%; margin-top: 4px;
      padding: 6px 8px;
      background: #0d0d1a; border: 1px solid #444;
      border-radius: 6px; color: #eee; font-size: 13px;
    }

    /* State panel below agent selector */
    #state-panel {
      padding: 8px 12px;
      border-top: 1px solid #2a2a3e;
      font-family: monospace; font-size: 12px;
    }
    .state-row {
      display: flex; justify-content: space-between;
      padding: 2px 0;
    }
    .state-key { color: #888; }
    .state-val { color: #4fc3f7; }
    .state-val.dead { color: #e55; }

    /* Right: VLM log */
    .vlm-panel {
      flex: 1; overflow-y: auto;
      padding: 12px 16px;
    }
    .vlm-panel h2 {
      font-size: 12px; color: #888;
      text-transform: uppercase; letter-spacing: 0.5px;
      margin-bottom: 10px;
    }
    .vlm-entry {
      padding: 10px 12px;
      margin-bottom: 8px;
      background: rgba(255,255,255,0.03);
      border: 1px solid #2a2a3e;
      border-radius: 6px;
      transition: border-color 0.15s, background 0.15s;
    }
    .vlm-entry.active {
      border-color: #4361ee;
      background: rgba(67,97,238,0.08);
    }
    .vlm-header {
      font-size: 11px; color: #4fc3f7;
      font-family: monospace;
      margin-bottom: 6px;
    }
    .vlm-obs {
      font-size: 13px; color: #ddd;
      line-height: 1.4;
      margin-bottom: 4px;
    }
    .vlm-reason {
      font-size: 12px; color: #999;
      font-style: italic;
      margin-bottom: 4px;
    }
    .vlm-action {
      font-size: 12px; color: #ffaa00;
      font-family: monospace;
    }
    .vlm-empty {
      color: #555; font-style: italic;
      padding: 20px 0; text-align: center;
    }

    /* Bottom controls */
    .controls {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 16px;
      background: #1a1a2e; border-top: 1px solid #333;
      height: 56px;
    }
    .controls button {
      padding: 6px 16px;
      background: #4361ee; border: none;
      border-radius: 6px; color: #fff;
      font-size: 13px; cursor: pointer;
      transition: background 0.15s;
      min-width: 70px;
    }
    .controls button:hover { background: #3a56d4; }
    .controls button.secondary {
      background: #2a2a3e; border: 1px solid #444;
      color: #ccc;
    }
    .controls button.secondary:hover { background: #3a3a4e; }
    #timeline {
      flex: 1;
      accent-color: #4361ee;
      cursor: pointer;
    }
    #step-label {
      font-size: 12px; color: #888;
      font-family: monospace;
      min-width: 140px; text-align: right;
    }
    .kbd-hint {
      font-size: 10px; color: #555;
      margin-left: 8px;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <h1>Replay</h1>
    <select id="session-select"></select>
    <button id="delete-btn" class="danger">Delete</button>
    <a href="/">Back to Sim</a>
  </div>

  <div class="main">
    <div class="pov-panel">
      <canvas id="pov-canvas" width="512" height="512"></canvas>
      <div class="agent-selector">
        <label>Agent</label>
        <select id="agent-select"></select>
      </div>
      <div id="state-panel"></div>
    </div>
    <div class="vlm-panel">
      <h2>VLM Output Log</h2>
      <div id="vlm-log"></div>
    </div>
  </div>

  <div class="controls">
    <button id="play-btn">Play</button>
    <button id="speed-btn" class="secondary">1x</button>
    <input id="timeline" type="range" min="1" max="1" value="1" />
    <span id="step-label">No session</span>
    <span class="kbd-hint">Space: play | Arrows: seek | 1/2/4: speed</span>
  </div>

  <script type="module" src="/dist/viewer.js"></script>
</body>
</html>
